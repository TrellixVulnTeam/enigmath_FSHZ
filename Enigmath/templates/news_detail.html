{% extends "base.html" %}
{% load urlify %}
{% load crispy_forms_tags %}

{% block head_title %}
{{ instance.title }} | {{ block.super }}
{% endblock head_title %}



{% block content %}
<div class='col-sm-6 col-sm-offset-3'>
	<h1>{{ title }} <small>{{ instance.publish }}</small></h1>
	
	{% if instance.user.get_full_name %}
		<p>Author: {{ instance.user.get_full_name }}</p>
	{% endif %}


	<div class='row'>
		<div class='col-sm-12'>
			{{ instance.get_markdown }}
		<hr/>
		{% if instance.image %}
	    	<img src='{{ instance.image.url }}' class='img-from-post' />
		{% endif %}

		<br/>

		</div>
	</div>

    <hr/>
    <br/>

    <div>
        <p class='lead'>Comments</p>
        <hr/>

        {% for comment in comments %}
			<blockquote>
				<div class="comment-user">{{ comment.user }}</div>
 		        <p>{{ comment.content }}</p>
		        <div class="small-details">{{ comment.timestamp|timesince }} ago |
		        <a class='comment-reply-btn' href='#'>{{ comment.children.count }} Comment{% if comment.children.count > 1 or comment.children.count == 0 %}s{% endif %}</a></div>
		        <div class='comment-reply'>
		              {% for child_comment in comment.children %}
		                <blockquote>
			                <div> <small>{{ child_comment.user }} | {{ child_comment.timestamp|timesince }} ago</small></div>
			                <p>{{ child_comment.content }}</p>		                
		                </blockquote>
		             {% endfor %}

		            <form method="POST" action="."> {% csrf_token %}
		                {{ comment_form|crispy }}
		                <input type='hidden' name='parent_id' value='{{ comment.id }}'>
		                <input type='submit' value='Reply' class='btn btn-info'>
		            </form>
		        </div>

	        </blockquote>

	         <hr/>

        {% endfor %}
        <form method="POST" action="" enctype='multipart/form-data'> {% csrf_token %}
            {{ comment_form|crispy }}
            <input type='submit' value='Post comment' class='btn btn-info'>
        </form>

    </div>

</div>






{% endblock content %}